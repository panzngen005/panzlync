<!DOCTYPE html>
<html lang="id">
<head>
    <!-- =================================================================
    PANZLYNC - HALAMAN PREVIEW MEDIA
    ================================================================== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Preview - Panzlync</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- CSS Reset & Variabel --- */
        :root { --primary-color: #3498db; --secondary-color: #2980b9; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; }

        /* --- Layout Utama --- */
        .preview-body { background-color: #111; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        .media-container { width: 100%; height: calc(100% - 60px); display: flex; justify-content: center; align-items: center; }
        .media-container img, .media-container video { max-width: 100%; max-height: 100%; object-fit: contain; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        
        /* --- Bar Informasi di Bawah --- */
        .media-info-bar { width: 100%; height: 60px; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(10px); position: absolute; bottom: 0; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; color: white; }
        #file-name { font-size: 0.9em; }
        .button-download-preview { text-decoration: none; color: white; background-color: var(--primary-color); padding: 8px 15px; border-radius: 8px; font-size: 0.9em; display: flex; align-items: center; gap: 8px; transition: background-color 0.2s; }
        .button-download-preview:hover { background-color: var(--secondary-color); }
        .error-message { color: white; font-size: 1.2em; }
        
        /* --- Responsif --- */
        @media (max-width: 600px) { .media-info-bar { flex-direction: column; height: auto; padding: 10px; gap: 10px; } }
    </style>
</head>
<body class="preview-body">
    <!-- =========== KONTENER MEDIA =========== -->
    <div class="media-container" id="media-container">
        <!-- Konten (gambar atau video) akan dimasukkan oleh JavaScript -->
    </div>
    
    <!-- =========== BAR INFORMASI & DOWNLOAD =========== -->
    <div class="media-info-bar">
        <p id="file-name">Memuat nama file...</p>
        <a href="#" id="download-button" class="button-download-preview" download>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            Unduh File Asli
        </a>
    </div>

    <!-- =========== SCRIPT JAVASCRIPT =========== -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mediaContainer = document.getElementById('media-container');
            const fileNameDisplay = document.getElementById('file-name');
            const downloadButton = document.getElementById('download-button');
            const pathParts = window.location.pathname.split('/');
            const token = pathParts[pathParts.length - 1];

            if (token) {
                fetch(`/api/meta/${token}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            mediaContainer.innerHTML = `<p class="error-message">${data.error}</p>`;
                            return;
                        }
                        fileNameDisplay.textContent = data.originalName;
                        downloadButton.href = `/download-file/${token}`;
                        downloadButton.setAttribute('download', data.originalName);
                        const streamUrl = `/stream/${token}`;
                        let mediaElement;

                        if (data.mimetype.startsWith('image/')) {
                            mediaElement = document.createElement('img');
                            mediaElement.src = streamUrl;
                            mediaElement.alt = data.originalName;
                        } else if (data.mimetype.startsWith('video/')) {
                            mediaElement = document.createElement('video');
                            mediaElement.src = streamUrl;
                            mediaElement.controls = true;
                            mediaElement.autoplay = true;
                            mediaElement.loop = true;
                        }

                        if (mediaElement) mediaContainer.appendChild(mediaElement);
                        else mediaContainer.innerHTML = `<p class="error-message">Tipe media tidak didukung.</p>`;
                    })
                    .catch(() => { mediaContainer.innerHTML = `<p class="error-message">Gagal memuat media.</p>`; });
            }
        });
    </script>
</body>
</html>

